{% extends "base_admin.html.twig" %}

{% block title %}

{% endblock %}

{% block stylesheets %}

{% endblock %}

{% block main_content %}

  <h3>{{'Home.Title'|trans}}</h3>

  <div class="col-md-12 mt-3">
    <div class="card">
      <div class="card-header">
        <h5>
          {{ 'Commercial.File.FileListTitle'|trans }}
        </h5>
        <div class="float-right">
          <a href="javascript:void(0);"
             class="btn btn-sm btn-primary"
             data-target="#uploadFileModal"
             data-toggle="modal"
             id="openModalUploadFile"><i
                    class="fa fa-file"></i> {{ 'Commercial.File.BtnAddLabel'| trans({}, "messages", app.request.locale) }}
          </a>
        </div>
      </div>
      <div class="card-body">
        <table id="FileListDatatable"
               class="table table-striped table-bordered table-hover"
               cellpadding="0" cellspacing="0" border="0">
          <thead>
          <tr>
            <th>{{ 'Commercial.File.FileNameColumn'| trans({}, "messages", app.request.locale) }}</th>
            <th>{{ 'Commercial.File.FileTypeColumn'| trans({}, "messages", app.request.locale) }}</th>
            <th></th>
          </tr>
          </thead>
          <tbody>

          {% if files is not null and files|length > 0 %}
            {% for file in files %}

              <tr>
                <td>
                  {{ file.originalFileName }}
                </td>

                <td>
                  {{ file.originalFileName|split('.')|last|upper }}
                </td>

                <td class="text-center">
                  <a href="{{ path('paprec_download_file', {id: file.id}) }}"
                     class="btn btn-sm btn-info">
                    <i class="fa fa-xs fa-download"></i>
                  </a>
                  <a href="#"
                     class="btn btn-sm btn-danger commercialFileRemoveButton"
                     data-id="{{ file.id }}">
                    <i class="fa fa-xs fa-trash"></i>
                  </a>
                </td>
              </tr>

            {% endfor %}
          {% endif %}

          </tbody>
        </table>
      </div>
    </div>


    <!-- Modal d'ajout de fichiers au mail -->
    <div class="modal fade" id="uploadFileModal" tabindex="-1" role="dialog"
         aria-labelledby="Upload Picture" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <form id="formAddFile" name="formAddFile"
                action="{{ path("paprec_add_file") }}"
                method="post" enctype="multipart/form-data">
            <div class="modal-header">
              <h5 class="modal-title">
                {{ 'Commercial.File.AddTitle'| trans({}, "messages", app.request.locale) }}
              </h5>
              <button type="button" class="close" data-dismiss="modal"
                      aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <div class="form-label">
                  <span>{{ 'Commercial.File.MaxSize'| trans({}, "messages", app.request.locale) }}</span>
                </div>
                <div class="form-content">
                  {{ form_widget(formAddFile.systemPath, {'attr': {'class': 'form-control'}}) }}
                  {{ form_errors(formAddFile.systemPath) }}
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-secondary"
                      data-dismiss="modal">
                {{ 'General.Cancel'| trans({}, "messages", app.request.locale) }}
              </button>
              <button type="button" class="btn btn-sm btn-primary"
                      id="formAddFileSubmitButton">
                {{ 'General.Save'| trans({}, "messages", app.request.locale) }}
              </button>
            </div>
            {{ form_rest(formAddFile) }}
          </form>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block javascripts %}
  <script>
    $(function () {

      $('[data-toggle="tooltip"],[data-tooltip="tooltip"]').tooltip();

      $('#formAddFileSubmitButton').on('click', function () {
        $('#formAddFile').submit();
      });

      $('.commercialFileRemoveButton').on('click', function () {
        var fileId = $(this).data('id');
        var url = "{{ path("paprec_remove_file", {id: '0000'}) }}".replace('0000', fileId);

        Swal.fire({
          title: "{{ 'General.Confirm'|trans }}",
          text: "{{ 'General.Confirm-remove'|trans }}",
          showCancelButton: true,
          confirmButtonText: "{{ 'General.Yes'|trans }}",
          cancelButtonText: "{{ 'General.No'|trans }}"
        }).then(function (result) {
          if (result.value) {
            $(location).attr('href', url);
          }
        });

      });

    });
  </script>

{% endblock %}
